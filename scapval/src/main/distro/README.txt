Security Content Automation Protocol (SCAP) Validator ${project.build.finalName}

Overview:
---------
Security Content Automation Protocol Validator (SCAPVal) is a Java Command Line Application that provides information
about whether SCAP content conforms to conventions and recommendations outlined in NIST Special Publication 800-126,
The Technical Specification for the Security Content Automation Protocol (SCAP). With support for SCAP 1.1, 1.2, and 1.3

SCAPVal validates the data stream according to one of the use cases for an SCAP-validated tool listed in 800-126,
namely Compliance Checking, Vulnerability Scanning, Inventory Scanning, and Other.
Checks components and data streams against appropriate schemas. Uses Schematron to perform additional checks within and across component data streams.

Stand alone XCCDF, OVAL, and OCIL files, separate from SCAP can also be validated using -componentfile.

SCAPVal produces validation results in a report that conveys all error and warning conditions detected; results are output in both XML and HTML formats.

For a listing of the SCAP requirements this tool adheres to, refer to the files in the /requirements directory.

Requires Java Runtime Environment (JRE) 1.8 or higher.
If the JAVA_HOME variable is set then the JRE which is at that location will be used. Otherwise the JRE available on the path is used.

Example Usage:
--------------
For a 1.3 Source Data Stream:
    "scapval.bat -scapversion 1.3 -file source_data_stream_collection_sample.xml"

For a 1.3 Result Data Stream:
    "scapval.bat -scapversion 1.3 -resultfile arf-result.xml"

For a 1.2 Source Data Stream with resolution of remote resources and verbose output:
     "scapval.bat -scapversion 1.2 -file datastream-12.xml -online -debug"

Results for the above are generated by default and provided in validation-report.html and validation-result.xml

Usage Details:
----
The tool's command line interface can be run using the following arguments:

usage: scapval <options>
 -combinedoutput <arg>   Creates an optional file for reference containing
                         any combined remote resources processed by
                         SCAPVal and any -sourceds Data Stream specified.
                         This file is a copy of the final content SCAPVal
                         validates against.
 -componentfile <arg>    Validate an individual component file. Currently
                         XCCDF/OVAL/OCIL is supported
 -debug                  Enable verbose output
 -dir <arg>              Directory of individual component SCAP files.
                         Provide if validating SCAP 1.1 source files only
 -file <arg>             SCAP Source XML file (SCAP 1.2, 1.3) or ZIP file
                         (SCAP 1.1). Only provide if validating source
                         files
 -h,--help               Display the available cli arguments
 -maxsize <arg>          Overwrites the default max download size for
                         remote references (specified in MiB)
 -online                 Enable download of latest dictionaries and remote
                         resolution of some components
 -quiet                  Silence console output
 -resultdir <arg>        Directory of individual component SCAP result
                         files. Provide if validating SCAP 1.1 result
                         files only
 -resultfile <arg>       SCAP result XML file (SCAP 1.2, 1.3) or ZIP file
                         (SCAP 1.1). Only provide if validating result
                         files
 -scapversion <arg>      The SCAP version to validate. 1.1, 1.2, and 1.3
                         are supported
 -sourceds <arg>         Specifies the location of the source data stream
                         to include with results. For SCAP 1.1 it will be
                         included in the 1.1 Data Stream, for SCAP 1.2 and
                         1.3 it will included in ARF Report
 -usecase <arg>          The SCAP use case. For 1.1 content CONFIGURATION,
                         VULNERABILITY_XCCDF_OVAL, SYSTEM_INVENTORY,
                         OVAL_ONLY  For 1.2/1.3 content CONFIGURATION,
                         VULNERABILITY, INVENTORY, OTHER This is required
                         for validation of .zip files or a directory of
                         component SCAP files.
 -valreportfile <FILE>   The validation HTML report file location
                         (default: validation-report.html)
 -valresultfile <FILE>   The validation result file location (default:
                         validation-result.xml)
 -version                Display the version of the tool

Use Notes:
----
Once the validation is completed, two result files will be created:

  validation-result.xml - An XML file containing the set of requirements used
      for validation, and the status of each requirement.
  validation-report.html - A human-readable report based on the validations
      results.

If remote resources are defined in content, SCAPVal will attempt to resolve them when when ran with the -online parameter.
The remote content will be downloaded and automatically combined with the local content before validation begins.
When validating result content and the source content is specified with -source_ds, SCAPVal will combine the two before validation begins.
SCAPVal will provide a combined content file for reference when using the -combinedcontent parameter to specify an output file location.

Feedback:
---------
Please send tool defects reports, enhancement requests, and any other related
comments by email to scap@nist.gov.

Changelog:
----------
Version ${project.version}
- Support for SCAP 1.3 added including new requirements from 800-126r3.
- Support for legacy SCAP 1.0 dropped.
- SCAPVal has been rewritten and now utilizing the NIST Decima Framework
- New HTML reporting format.

1.2.1.16 12/16/2016
* SWID tag included.
* Report improvements for component file checks.
* OVAL result schematron rules are now checking within ARF content.
* Improvements to schematron rules 126-1, 126-2, 126-3, 126-4, and 260-1
* Schematron rule 126-5 added to improve ARF validation of <xccdf:rule-results>
* Added oval-def:platform='Microsoft Windows Server 2016' to list of valid windows family for all OVAL schematrons from 5.3 through 5.9
* Improved error handling when encountering a TransformerException while processing schematron rules.

1.2.1.15 08/05/2016
* Support for remote components in 1.2 data streams added.
* Fixed certain cases where 1.2 result file validation resulted in runtime errors.
* Various schema updates.
* Added option -componentfile to validate individual XCCDF, OVAL, and OCIL files.
* Improved validation of XCCDF and OVAL content.
* Improved OVAL result file processing.
* Improved results checking for 1.1 content.

1.2.1.14 04/15/2016
* Improved processing SCAP content with <xccdf:check> and <xccdf:complex-check> elements.
* Improved processing SCAP content with <xccdf:Tailoring> elements.
* Improved processing SCAP content utilizing OVAL 5.10.1
* Improved schematron rules and processing for requirements 3, 8, 31, 38, 40, 44, 126, 134, 135, 179-181, 236, 242, 248, 260, 262, 265, 341, 370.
* Updated the included nvdcce-0.1-feed.xml and official-cpe-dictionary_v2.2.xml files.
* Fixed certain cases when the SCAP Content Validation Report incorrectly reported failed results.
* When using the -online parameter, scapval will now first check the NVD site for updated content and only download if new content is detected.
* Statistics included at end validation results for source data streams.
* Several bug fixes.
* Added option -source_ds to combine a specified source-data-stream into an existing ARF result file and -crpath to specify a custom location for its output.
* Added oval-def:platform='Microsoft Windows 10' to list of valid windows family for all OVAL schematrons from 5.3 through 5.9.

1.2.1.13 04/08/2015
* Added or oval-def:platform='Microsoft Windows Server 2012 R2'
    or oval-def:platform='Microsoft Windows 8.1'
    to list of valid windows family for all OVAL schematron from 5.3 through 5.9.

1.2.1.12 03/31/2015
* fix OCIL validation to use released version of schema instead of DRAFT

1.2.1.11 05/30/2014
* Fix for running on Java 8
* Fix NullPointerException when attempting to download a file larger than the maxdownload size option
* Increased default maxdownload size to 30 MB.

1.2.1.10 04/30/2014

* Issue:If the number of <xccdf:target> and <xccdf:target-address> are not equal, SCAPVal flags it as an error.
  Fix:  Updated the Schematron results validation (1.2) for the requirement 136 to comply with section 4.5 of the SP800-126 which says:
  "6. Each IP address associated with the <xccdf:target> SHALL be enumerated using the <xccdf:target-address> element."

* Issue:SCAPVal expects <xccdf:check/xccdf:check-content-ref> element if the <xccdf:result> is not equal to 'notapplicable'.
  Fix:  Updated the Schematron results validation (1.2) for the requirement 260 to require <xccdf:check/xccdf:check-content-ref> element
  only if the <xccdf:result> is not equal to 'notapplicable', 'notchecked' or 'notselected'.
  This complies with the the documentation for the "notchecked" result and section 4.5 of the SP800-126 which says:
  "The <xccdf:rule-result> elements report the result of the application of each selected rule [XCCDF:6.6.2].
  ~The <xccdf:check/xccdf:check-content-ref> element SHALL record the reference to the check system specific result component report ID
  and check name within the result file using the @href and @name attributes, respectively."

* Issue: SCAPVal expects <xccdf:result> for 'notselected' rules.
  Description: According to XCCDF and SCAP 1.2 specifications, a result of "notselected" is not required to be produced if the rule is not selected.
  Fix:  Updated the Schematron results validation (1.2) for the requirement 126 to check if the xccdf:result eq 'notselected'

1.2.1.9 06/19/2013

* Updated to include latest Schematron validation (1.2).
* Fixed incorrect message for command-line options

1.2.1.7 and 1.2.1.8 02/19/2013

* Internal release to resolve issues relating to deployment of the tool within
  the context of a web application server

1.2.1.6    01/29/2013

* Added OVAL 5.10.1 as a valid schema_version in the Schematron validation

* Fixed minor bug in check for requirement 126 when an XCCDF rule is not selected.

1.2.1.4    05/01/2012

* Removing unused, conflicting XML schemas

* Added latest XCCDF 1.2.1, OVAL 5.10.1, Asset Identification and ARF XML schemas

* Removed requirement 211-1 as it was erroneous

* Removed requirement 171 and 275 based on errata E4

* Adding XCCDF 1.2 schematron

* Added warning if unrecognized namespaces are encountered in content

1.2.1.3    12/22/2011

* Minor bug fixes

* Added additional detailed error messages for select Schematron rules

1.2.1.2    12/06/2011

* Included several bug fixes

* Added functionality to provide more detailed error messages for some less specific Schematron errors

1.2.1.1    10/19/2011

*Added SCAP 1.2 source and results

1.1.2.9    4/28/2011

* Adding latest and final version of OCIL schema

1.1.2.7    3/29/2011

* Fixing Schematron assertion when patches file is remote

1.1.2.6    3/28/2011

* Set the Validation Program OVAL test type warning to INFO

* Fixed check on requirement 225

* Fixed issue where files were being downloaded even when the -online flag wasn't set

* Fixed issue when running OVAL 5.8 content that caused bad errors to be reported

1.1.2.5    3/08/2011

* Updated tool to remove naming convention for remote patches up to date OVAL files

* Added the -maxsize command line option

1.1.2.4    3/04/2011

* Fixed issues related to the tool path containing spaces

* Removed the 800-126 document

* Fixed the functionality of the version flag so that the tool reports the version and terminates

1.1.2.3    3/01/2011

* Updated tool to the final draft release of 800-126 rev 1

* Includes support for OVAL 5.3 - 5.8

* Added warning if OVAL test types are used in source content that are not
	currently validated in the SCAP Validation Program

* Fixed miscellaneous bugs in the tool

* Fixed the XSLT that generates the final result HTML

* Updating the error message when an XCCDF references an external patch file

1.1.2.2    12/22/2010

* Added support for SCAP 1.1

* Added support to validate SCAP result files

0.9   01/08/2010

Requires JRE 1.6 or higher.
If the JAVA_HOME variable is set then the JRE which is at that location will be
used.  Otherwise the JRE available on the path is used.

This bundle is a pre-release version of the content validation tool.  It is not
yet feature complete but will perform the majority of the validation steps that
the final release will perform.

This tool will take as input either a zip bundle or an SCAP data stream XML file
that conforms to the SCAP data stream XML Schema.  The data stream format is union
of the files contained within the zip bundle.  The expected common case is that
a zip bundle will be supplied.  When providing the ZIP, the ZIP must contain
the component XML files, correctly named, at the base of the ZIP file (i.e. not
inside any folders).  In addition, no other files should exist in the ZIP file.
The -dir option is similar to specifying a ZIP file, but with the files unzipped
into a directory.  The files should be at the root of the directory specified.

When a zip bundle is provided, the SCAP version is also needed.

When a zip bundle is provided, the SCAP use case is also needed.  The SCAP use
cases which are available for SCAL 1.0 are: CONFIGURATION, VULNERABILITY_XCCDF_OVAL,
VULNERABILITY_OVAL, SYSTEM_INVENTORY.  The SCAP use cases which are available
for SCAL 1.1 are: CONFIGURATION, VULNERABILITY_XCCDF_OVAL, VULNERABILITY_OVAL,
SYSTEM_INVENTORY, PATCH

An optional but important switch (-online) is also available to permit the tool
to connect through the internet to download files which are referenced within
the bundle, but were not provided.  (A typical example would be the oval patch
definitions which have both a remote and a local reference.)

Once the tool has completed validation a results file is created (the default
name is scap-validation-result.xml), which contains a detailed listing of the
issues discovered.  The results file contains the name of the file in the
bundle and an XPATH expression where the error was found.

The -batch option allows the user to run multiple validations in sequence against
different source content.  When the -batch option is specified, -file should point
to a ZIP file, or -dir should point to a directory.  Within that ZIP file or
directory, at the root level, should be XML data stream files, SCAP content in
ZIP files, directories with SCAP content in the root of each directory, or any
combination of those three options.  The validation tool will then iterate
through each source content XML, ZIP or directory, and validate the content.

The -resultfile or -resultdir are used to validate result content.  When using
-resultfile, point to a ZIP file that contains the result files in the root
of the ZIP file.  When using -resultdir, point to a directory that contains the
result files in the root of the directory.  When specifying results, the source
content must also be specified.  In addition, if the results were generated
by specifying an XCCDF profile in the source content, provide that profile, which
is case-sensitive, using the -profile option.

The requirement IDs which are referenced are explained further in the
"scap-val-requirements-1.X.html" document which has been
provided along with the zip file.  The section numbers in the matrix refer to
SP 800-126 v1.x, respectively, which is available at
http://csrc.nist.gov/publications/PubsSPs.html.

OVAL 5.3 AND 5.4:

1. To validate OVAL content, the tool uses an OVAL Definition Schematron
schemas that has been modified to use XPath 1.0 instead of XPath 2.0.  To run as
XPath 1.0, the queryBinding="xslt2" attributes were removed from the root element
of the schematron schemas.  The modification was made to avoid an XPath exception
in the floor() function when the current element being processed is not a node.

2. To validate Windows content, the OVAL 5.4 schema and OVAL 5.3 schematron were
modified to allow the following oval-def:platforms:

oval-def:platform='Microsoft Windows Server 2008'
or  oval-def:platform='Microsoft Windows 7'
or oval-def:platform='Microsoft Windows Server 2008 R2'

In OVAL 5.3, a pattern with ID = "fileobjfilename" has a single rule with an
erroneous assertion. The test was corrected in OVAL 5.5, therefore the test
from OVAL 5.5 is used in place of the OVAL 5.3 test.

In OVAL 5.3, a pattern with ID = "regstevalue" has a single rule with an erroneous
assertion. The assertion was removed in OVAL 5.4 and later. In order to fix the
assertion in the OVAL 5.3 Schematron, the test was updated for this tool.

The official OVAL schema and schematron can be found at
http://oval.mitre.org/language/download/schema/version5.3/ and
http://oval.mitre.org/language/download/schema/version5.4/.

EXAMPLES:

To see available command line options:
scapval

To validate the SCAP content in the file scap-content.zip for the CONFIGURATION
use case:
scapval -file c:\scapfiles\scap-content.zip -usecase CONFIGURATION

To enable resolution of remote OVAL files (e.g., patches) using HTTP connection:
scapval -file c:\scapfiles\scap-content.zip -usecase CONFIGURATION -online

To use Schematron rules in a different directory:
scapval -file c:\scapfiles\scap-content.zip -usecase CONFIGURATION -ruledir c:\myruledirectory

To send output to a different file:
scapval -file c:\scapfiles\scap-content.zip -usecase CONFIGURATION -result myresult.xml

To validate a combined SCAP content file that contains XCCDF, OVAL, etc.:
scapval -file c:\scapfiles\scap-content.xml

To turn on verbose console messages:
scapval -file c:\scapfiles\scap-content.zip -usecase CONFIGURATION -debug

To hide all console messages:
scapval -file c:\scapfiles\scap-content.zip -usecase CONFIGURATION -quiet

0.8:
* For SCAP schematron messages, provide an XPath location to the node in question that is
relative to the input file in the SCAP ZIP bundle.

* Added level attribute to the message element in the validation results to indicate
whether an SCAP schematron message is a WARNING or ERROR.

* For traceability, added the names of the input files to the end of the validation results,
with SHA-256 hash values.  Also the SCAP version, the highest OVAL version, and
a timestamp to the validation results.

* Validate OVAL documents against both OVAL 5.3 and 5.4 schemas a) to warn when a document
marked as OVAL 5.4 is actually valid for 5.3 and b) to produce an error when document
marked as 5.3 fails to validate against 5.4.  Also now included with the tool is the complete
set of OVAL definition schemas.

* Moved the schematron rule files into the SCAP validation JAR file so that an external
rule directory is not required.  Rule developers can still use the -ruledir option to
explicitly specify an external rule directory.

* Renamed the schema for the validation results from data-stream-0.1.xsd to
scap-data-stream-0.1.xsd.

* The combined SCAP data stream .xml file that is generated by the tool is no longer left in
the working folder when the tool finishes.  Instead a temporary file is created and deleted.
In a future version of the tool, this will likely be a user option.
