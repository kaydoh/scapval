<?xml version="1.0" encoding="UTF-8"?>
<content-unit-test xmlns="http://decima.nist.gov/xml/unit-test">
  <requirement>243</requirement>
  <description>This is a minimal valid schema for the Configuration use case.
               When an xccdf:Rule references an OVAL Vulnerability component, it must 
              reference an OVAL vulnerability definition in that component.</description>
  <template xmlns="http://csrc.nist.gov/ns/decima/template/1.0"
  xmlns:ds="http://scap.nist.gov/schema/data-stream/0.2"
  xmlns:xccdf="http://checklists.nist.gov/xccdf/1.1"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" template="classpath:scap-1.1/templates/vulnerability-xccdf-use-case-base.xml">
    
    <insert-sibling xpath="//*:check-system-content[@content-type='OVAL_VULNERABILITY']">
      <check-system-content content-type="OVAL_VULNERABILITY" id="minimal2-oval.xml" xmlns="http://scap.nist.gov/schema/data-stream/0.2">
        <oval_definitions xmlns="http://oval.mitre.org/XMLSchema/oval-definitions-5" xmlns:ind-def="http://oval.mitre.org/XMLSchema/oval-definitions-5#independent" xmlns:oval="http://oval.mitre.org/XMLSchema/oval-common-5" xmlns:oval-def="http://oval.mitre.org/XMLSchema/oval-definitions-5" xmlns:win-def="http://oval.mitre.org/XMLSchema/oval-definitions-5#windows" xsi:schemaLocation="http://oval.mitre.org/XMLSchema/oval-definitions-5#windows http://oval.mitre.org/language/download/schema/version5.3/ovaldefinition/complete/windows-definitions-schema.xsd       http://oval.mitre.org/XMLSchema/oval-definitions-5#independent http://oval.mitre.org/language/download/schema/version5.3/ovaldefinition/complete/independent-definitions-schema.xsd       http://oval.mitre.org/XMLSchema/oval-definitions-5 http://oval.mitre.org/language/download/schema/version5.3/ovaldefinition/complete/oval-definitions-schema.xsd       http://oval.mitre.org/XMLSchema/oval-common-5 http://oval.mitre.org/language/download/schema/version5.3/ovaldefinition/complete/oval-common-schema.xsd">
          <generator>
            <oval:schema_version>5.3</oval:schema_version>
            <oval:timestamp>2009-12-01T00:00:00</oval:timestamp>
          </generator>
          <definitions>
            <definition id="oval:gov.nist.test.vulnerability:def:2" version="1" class="vulnerability">
              <metadata>
                <title>Test Title</title>
                <affected family="windows">
                  <platform>Microsoft Windows XP</platform>
                </affected>
                <description>Test Description</description>
                <reference source="http://cve.mitre.org" ref_id="CVE-1999-0002" />
              </metadata>
            </definition>
          </definitions>
        </oval_definitions>
      </check-system-content>
    </insert-sibling>
    
    <replace xpath="//*:Rule[@id='test_rule1']" >
         <Rule id="security_patches_up_to_date" selected="false" weight="10.0" xmlns="http://checklists.nist.gov/xccdf/1.1">
            <title>Test Title for Rule 1</title>
            <description>Test Description for Rule 1</description>
            <ident system="http://cve.mitre.org">CVE-1999-0002</ident>     
            <check system="http://oval.mitre.org/XMLSchema/oval-definitions-5">            
               <check-content-ref href="minimal-oval.xml" name="oval:gov.nist.test.vulnerability:def:2"/>
        </check>
         </Rule>
    </replace>
  
  </template>
  <assessments>
    <schematron-assessment ruleset="classpath:rules/scap/source-data-stream-1.1.sch" handler-class="gov.nist.secauto.scap.validation.decima.requirements.SCAPSchematronHandler" phase="VULNERABILITY">
      <parameter name="datafiles_directory">classpath:data_feeds</parameter>
    </schematron-assessment>
  </assessments>
  <assertions>
    <assert-derived-requirement requirement-id="SRC-243-4" result="FAIL" />
	<!-- Also, expect A15 to fail due to an unused oval definition. -->
    <assert-derived-requirement requirement-id="A-15-1" result="FAIL" />
    <!-- Also, expect 154-1 to fail because we have modified the resource ID-->
    <assert-derived-requirement requirement-id="SRC-154-1" result="FAIL" />
    
    <assert-remaining quantifier="ALL" result="PASS" />
  </assertions>
</content-unit-test>
